<!-- project build configuration -->
<project name="Game Gardens Server" default="sign" basedir=".">

  <!-- load up our configuration information -->
  <property file="toybox.properties"/>

  <!-- things you probably don't want to change -->
  <property name="deploy.dir"     value="dist"/>
  <property name="projects.root"  value="."/>

  <!-- declare the location of our various subprojects -->
  <property name="libs.dir"       value="lib"/>
  <property name="samskivert.dir" value="projects/samskivert"/>
  <property name="narya.dir"      value="projects/narya"/>
  <property name="nenya.dir"      value="projects/nenya"/>
  <property name="vilya.dir"      value="projects/vilya"/>
  <property name="toybox.dir"     value="projects/toybox"/>
  <property name="gardens.dir"    value="projects/gardens"/>

  <!-- import useful tasks -->
  <import file="etc/build-support.xml"/>
  <import file="etc/project-dependencies.xml"/>

  <!-- declare the libraries needed by the main thing -->
  <fileset dir="${projects.root}" id="dist.libs">
    <include name="${libs.dir}/activation.jar"/>
    <include name="${libs.dir}/commons-beanutils.jar"/>
    <include name="${libs.dir}/commons-collections.jar"/>
    <include name="${libs.dir}/commons-digester.jar"/>
    <include name="${libs.dir}/commons-fileupload-1.0.jar"/>
    <include name="${libs.dir}/commons-io.jar"/>
    <include name="${libs.dir}/commons-logging.jar"/>
    <include name="${libs.dir}/getdown.jar"/>
    <include name="${libs.dir}/mail.jar"/>
    <include name="${libs.dir}/mysql-connector-java-3.0.11-stable-bin.jar"/>
    <include name="${libs.dir}/servlet-2.3.jar"/>
    <include name="${libs.dir}/velocity-1.5-dev.jar"/>
    <include name="${narya.dir}/dist/narya-base.jar"/>
    <include name="${narya.dir}/dist/narya-distrib.jar"/>
    <include name="${nenya.dir}/dist/nenya-media.jar"/>
    <include name="${nenya.dir}/dist/nenya-rsrc.jar"/>
    <include name="${samskivert.dir}/dist/samskivert.jar"/>
    <include name="${vilya.dir}/dist/vilya-micasa.jar"/>
    <include name="${vilya.dir}/dist/vilya-parlor.jar"/>
  </fileset>

  <!-- declare the libraries needed to build toybox -->
  <fileset dir="${projects.root}" id="toybox.libs">
    <include name="${libs.dir}/ant.jar"/>
    <include name="${libs.dir}/commons-beanutils.jar"/>
    <include name="${libs.dir}/commons-collections.jar"/>
    <include name="${libs.dir}/commons-digester.jar"/>
    <include name="${libs.dir}/commons-io.jar"/>
    <include name="${libs.dir}/commons-lang.jar"/>
    <include name="${libs.dir}/commons-logging.jar"/>
    <include name="${libs.dir}/getdown.jar"/>
    <include name="${libs.dir}/velocity-1.5-dev.jar"/>
    <include name="${samskivert.dir}/dist/samskivert.jar"/>
    <include name="${narya.dir}/dist/narya-base.jar"/>
    <include name="${narya.dir}/dist/narya-distrib.jar"/>
    <include name="${nenya.dir}/dist/nenya-media.jar"/>
    <include name="${nenya.dir}/dist/nenya-rsrc.jar"/>
    <include name="${vilya.dir}/dist/vilya-micasa.jar"/>
    <include name="${vilya.dir}/dist/vilya-parlor.jar"/>
  </fileset>

  <!-- delcare our subprojects and webapps -->
  <property name="projects" value="samskivert,narya,nenya,vilya,toybox"/>
  <property name="webapps"  value="gardens"/>

  <!-- creates the Proguarded Java client -->
  <target name="client" depends="copydistlibs">
    <ant dir="projects/client" target="all" inheritAll="false"/>
  </target>

  <!-- signs the server jar files -->
  <target name="sign">
    <!-- copy any updated jar files into the seclib directory -->
    <mkdir dir="seclib"/>
    <copy todir="seclib">
      <fileset dir="lib" includes="*.jar"/>
    </copy>

    <!-- now sign them -->
    <signjar lazy="true" alias="${sign.alias}" keystore="${sign.keystore}"
             storepass="${sign.storepass}">
      <fileset dir="seclib" includes="*.jar"/>
    </signjar>
  </target>

  <!-- the default target is to install and sign the client -->
  <target name="all" depends="sign"/>

  <!-- rebuilds all subprojects and the top-level application -->
  <target name="distall" depends="distprojects,copydistlibs"/>

  <!-- fully cleans out the installed application and all subprojects -->
  <target name="cleanall" depends="cleanprojects">
    <ant dir="projects/client" target="clean" inheritAll="false"/>
    <delete dir="${deploy.dir}"/>
  </target>
</project>
