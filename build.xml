<!-- project build configuration -->
<project name="Game Gardens" default="all" basedir=".">

  <!-- load up our configuration information -->
  <property file="toybox.properties"/>

  <!-- things you probably don't want to change -->
  <property name="deploy.dir"  value="dist"/>
  <property name="extlibs.dir" value="lib"/>

  <!-- declare our subprojects and webapps -->
  <property name="projects" value="samskivert,narya,nenya,vilya,toybox"/>
  <property name="webapps"  value="gardens"/>
  <import file="build/etc/build-support.xml"/>

  <!-- declare the libraries needed by the main thing -->
  <filelist dir="." id="dist.libs">
    <file name="${extlibs.dir}/ant.jar"/>
    <file name="${extlibs.dir}/activation.jar"/>
    <file name="${extlibs.dir}/commons-beanutils.jar"/>
    <file name="${extlibs.dir}/commons-collections.jar"/>
    <file name="${extlibs.dir}/commons-digester.jar"/>
    <file name="${extlibs.dir}/commons-fileupload.jar"/>
    <file name="${extlibs.dir}/commons-io.jar"/>
    <file name="${extlibs.dir}/commons-lang.jar"/>
    <file name="${extlibs.dir}/commons-logging.jar"/>
    <file name="${extlibs.dir}/getdown.jar"/>
    <file name="${extlibs.dir}/google-collect.jar"/>
    <file name="${extlibs.dir}/javassist.jar"/>
    <file name="${extlibs.dir}/junit-3.7.jar"/>
    <file name="${extlibs.dir}/junit4.jar"/>
    <file name="${extlibs.dir}/mail.jar"/>
    <file name="${extlibs.dir}/mysql-connector-java.jar"/>
    <file name="${extlibs.dir}/proguard.jar"/>
    <file name="${extlibs.dir}/servlet-api.jar"/>
    <file name="${extlibs.dir}/velocity-1.5-dev.jar"/>
  </filelist>

  <!-- creates the Proguarded Java client -->
  <target name="client" depends="copydistlibs">
    <ant dir="projects/client" target="all" inheritAll="false"/>
  </target>

  <!-- the default target is to install and sign the client -->
  <target name="all"/>

  <!-- prepares the build directories, ensures that a toybox.properties exists -->
  <target name="prepare" depends="copydistlibs">
    <if><not><isset property="webapp_dir"/></not><then>
      <echo>Generating default toybox.properties.</echo>
      <copy tofile="toybox.properties" file="toybox.properties.dist"/>
    </then></if>
    <copy file="toybox.properties" todir="${deploy.dir}"/>
    <!-- XXX legacy, remove when NWO released -->
    <copy todir="${deploy.dir}/lib">
      <fileset dir="lib" includes="threerings.jar"/> <!-- optional -->
    </copy>
  </target>

  <!-- convenience targets that build specific projects and copy the results -->
  <target name="toybox">
    <antcall target="distprojects"><param name="projects" value="toybox"/></antcall>
  </target>
  <target name="gardens">
    <antcall target="distprojects"><param name="projects" value="gardens"/></antcall>
  </target>

  <!-- rebuilds all subprojects and the top-level application -->
  <target name="distall" depends="prepare,distprojects,distwebapps,client">
    <!-- copy our jar files into a directory where the games can build against them -->
    <copy todir="projects/games/lib">
      <fileset dir="${deploy.dir}/lib" includes="**/*.jar"/>
    </copy>
  </target>

  <!-- cleans out the compiled code -->
  <target name="clean">
    <ant dir="projects/client" target="clean" inheritAll="false"/>
  </target>

  <!-- fully cleans out the application -->
  <target name="distclean" depends="clean">
    <delete dir="${deploy.dir}"/>
    <delete><fileset dir="projects/games/lib" includes="**/*.jar"/></delete>
  </target>

  <!-- fully cleans out the application and all subprojects -->
  <target name="distcleanall" depends="distcleanprojects,distcleanwebapps,distclean"/>
</project>
