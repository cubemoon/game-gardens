#!/bin/sh
#
# $Id: mysql 254 2004-11-16 23:03:50Z mdb $
#
# A script for invoking mysql with a connection to our database

USAGE="Usage: $0 [--dbhost database_host] [--slave]"
ROOT=`dirname $0 | sed s:/bin::`

# Load in our machine-local configurations
if [ -f $ROOT/gardens.conf ]; then
    . $ROOT/gardens.conf
else
    echo "No $ROOT/gardens.conf could be found."
    exit -1
fi

if [ "$1" = "--dbhost" ]; then
    shift
    if [ -z "$1" ]; then
        echo $USAGE
        exit -1
    fi
    DBSERVER=$1
    shift
fi

WHICH=master
if [ "$1" = "--slave" ]; then
    shift
    WHICH=slave
fi

MYSQLARGS="-u $DBUSER -p$DBPASSWD"
if [ -f $ROOT/etc/mysql-$WHICH.cnf ]; then
    mysql --defaults-file=$ROOT/etc/mysql-$WHICH.cnf $MYSQLARGS "$@"
else
    mysql $MYSQLARGS -h $DBSERVER -P 3307 "$@"
fi
