#!/bin/sh
#
# $Id: rungardens 260 2004-12-03 17:55:21Z mdb $
#
# A script to invoke the Game Gardens server "interactively" while developing.

GARDENS_HOME=`dirname $0`/..
GARDENS_HOME=`echo $GARDENS_HOME | sed 's:/bin/..::g'`

# Load settings with those from gardens.conf
if [ -f $GARDENS_HOME/dist/gardens.conf ]; then
    . $GARDENS_HOME/dist/gardens.conf
else
    echo "Can't load '$GARDENS_HOME/dist/gardens.conf'; can't run server."
    exit 255
fi

CLASS=com.threerings.toybox.server.ToyBoxServer
JAVA_ARGS="-server -Dlog_level=$LOGLEVEL"
umask 002

# Start with the deployment directory
CLASSPATH="$GARDENS_HOME/dist"
# Add all JAR files in $GARDENS_HOME/dist/lib to the CLASSPATH
for jar in $GARDENS_HOME/dist/lib/*.jar; do
    if [ -e $jar ]; then
        CLASSPATH=$CLASSPATH:$jar
    fi
done
export CLASSPATH

# Set up the LD_LIBRARY_PATH to include our shared libraries
LD_LIBRARY_PATH=$GARDENS_HOME/dist/lib/i686-Linux
export LD_LIBRARY_PATH

# Start up the server
echo "Running Game Gardens server:"
echo "    Gardens root: $GARDENS_HOME"
echo "         Java VM: $JAVA_VM"
echo "       Java args: $JAVA_ARGS"
echo "    Server class: $CLASS"

java $JAVA_ARGS $CLASS
exit $?
